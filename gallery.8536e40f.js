function t(t,e,n,i){Object.defineProperty(t,e,{get:n,set:i,enumerable:!0,configurable:!0})}function e(t){return t&&t.__esModule?t.default:t}var n="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},i={},o={},s=n.parcelRequire4141;null==s&&((s=function(t){if(t in i)return i[t].exports;if(t in o){var e=o[t];delete o[t];var n={id:t,exports:{}};return i[t]=n,e.call(n.exports,n,n.exports),n.exports}var s=new Error("Cannot find module '"+t+"'");throw s.code="MODULE_NOT_FOUND",s}).register=function(t,e){o[t]=e},n.parcelRequire4141=s),s.register("2xTO9",(function(t,e){var n=s("ilwiq"),i=s("8PNKb");t.exports=(t,e)=>{const o=new(0,n.SphereBufferGeometry)(.3,16,16);o.translate(0,.3,0);const s=new(0,n.MeshBasicMaterial)({side:n.BackSide,color:0,transparent:!0}),a=new(0,n.Mesh)(o,s);return a.rotation.set(Math.PI/2,0,0),a.position.set(0,0,-.3),a.visible=!1,t.add(a),s.renderOrder=-101,function(t){a.visible=!0,a.material.opacity=0,new i.default.Tween(a.material).to({opacity:1},200).easing(i.default.Easing.Quadratic.Out).onComplete((function(){e.position.add(t),new i.default.Tween(a.material).to({opacity:0},200).onComplete((()=>a.visible=!1)).start()})).start()}}})),s.register("8PNKb",(function(e,n){t(e.exports,"default",(()=>w));var i,o=s("hPtJY"),a={Linear:{None:function(t){return t}},Quadratic:{In:function(t){return t*t},Out:function(t){return t*(2-t)},InOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Cubic:{In:function(t){return t*t*t},Out:function(t){return--t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}},Quartic:{In:function(t){return t*t*t*t},Out:function(t){return 1- --t*t*t*t},InOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}},Quintic:{In:function(t){return t*t*t*t*t},Out:function(t){return--t*t*t*t*t+1},InOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}},Sinusoidal:{In:function(t){return 1-Math.cos(t*Math.PI/2)},Out:function(t){return Math.sin(t*Math.PI/2)},InOut:function(t){return.5*(1-Math.cos(Math.PI*t))}},Exponential:{In:function(t){return 0===t?0:Math.pow(1024,t-1)},Out:function(t){return 1===t?1:1-Math.pow(2,-10*t)},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}},Circular:{In:function(t){return 1-Math.sqrt(1-t*t)},Out:function(t){return Math.sqrt(1- --t*t)},InOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}},Elastic:{In:function(t){return 0===t?0:1===t?1:-Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)},Out:function(t){return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin(5*(t-.1)*Math.PI)+1},InOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?-.5*Math.pow(2,10*(t-1))*Math.sin(5*(t-1.1)*Math.PI):.5*Math.pow(2,-10*(t-1))*Math.sin(5*(t-1.1)*Math.PI)+1}},Back:{In:function(t){var e=1.70158;return t*t*((e+1)*t-e)},Out:function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},InOut:function(t){var e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)}},Bounce:{In:function(t){return 1-a.Bounce.Out(1-t)},Out:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},InOut:function(t){return t<.5?.5*a.Bounce.In(2*t):.5*a.Bounce.Out(2*t-1)+.5}}},r="undefined"==typeof self&&void 0!==o&&o.hrtime?function(){var t=o.hrtime();return 1e3*t[0]+t[1]/1e6}:"undefined"!=typeof self&&void 0!==self.performance&&void 0!==self.performance.now?self.performance.now.bind(self.performance):void 0!==Date.now?Date.now:function(){return(new Date).getTime()},l=function(){function t(){this._tweens={},this._tweensAddedDuringUpdate={}}return t.prototype.getAll=function(){var t=this;return Object.keys(this._tweens).map((function(e){return t._tweens[e]}))},t.prototype.removeAll=function(){this._tweens={}},t.prototype.add=function(t){this._tweens[t.getId()]=t,this._tweensAddedDuringUpdate[t.getId()]=t},t.prototype.remove=function(t){delete this._tweens[t.getId()],delete this._tweensAddedDuringUpdate[t.getId()]},t.prototype.update=function(t,e){void 0===t&&(t=r()),void 0===e&&(e=!1);var n=Object.keys(this._tweens);if(0===n.length)return!1;for(;n.length>0;){this._tweensAddedDuringUpdate={};for(var i=0;i<n.length;i++){var o=this._tweens[n[i]],s=!e;o&&!1===o.update(t,s)&&!e&&delete this._tweens[n[i]]}n=Object.keys(this._tweensAddedDuringUpdate)}return!0},t}(),d={Linear:function(t,e){var n=t.length-1,i=n*e,o=Math.floor(i),s=d.Utils.Linear;return e<0?s(t[0],t[1],i):e>1?s(t[n],t[n-1],n-i):s(t[o],t[o+1>n?n:o+1],i-o)},Bezier:function(t,e){for(var n=0,i=t.length-1,o=Math.pow,s=d.Utils.Bernstein,a=0;a<=i;a++)n+=o(1-e,i-a)*o(e,a)*t[a]*s(i,a);return n},CatmullRom:function(t,e){var n=t.length-1,i=n*e,o=Math.floor(i),s=d.Utils.CatmullRom;return t[0]===t[n]?(e<0&&(o=Math.floor(i=n*(1+e))),s(t[(o-1+n)%n],t[o],t[(o+1)%n],t[(o+2)%n],i-o)):e<0?t[0]-(s(t[0],t[0],t[1],t[1],-i)-t[0]):e>1?t[n]-(s(t[n],t[n],t[n-1],t[n-1],i-n)-t[n]):s(t[o?o-1:0],t[o],t[n<o+1?n:o+1],t[n<o+2?n:o+2],i-o)},Utils:{Linear:function(t,e,n){return(e-t)*n+t},Bernstein:function(t,e){var n=d.Utils.Factorial;return n(t)/n(e)/n(t-e)},Factorial:(i=[1],function(t){var e=1;if(i[t])return i[t];for(var n=t;n>1;n--)e*=n;return i[t]=e,e}),CatmullRom:function(t,e,n,i,o){var s=.5*(n-t),a=.5*(i-e),r=o*o;return(2*e-2*n+s+a)*(o*r)+(-3*e+3*n-2*s-a)*r+s*o+e}}},u=function(){function t(){}return t.nextId=function(){return t._nextId++},t._nextId=0,t}(),h=new l,c=function(){function t(t,e){void 0===e&&(e=h),this._object=t,this._group=e,this._isPaused=!1,this._pauseStart=0,this._valuesStart={},this._valuesEnd={},this._valuesStartRepeat={},this._duration=1e3,this._initialRepeat=0,this._repeat=0,this._yoyo=!1,this._isPlaying=!1,this._reversed=!1,this._delayTime=0,this._startTime=0,this._easingFunction=a.Linear.None,this._interpolationFunction=d.Linear,this._chainedTweens=[],this._onStartCallbackFired=!1,this._id=u.nextId(),this._isChainStopped=!1,this._goToEnd=!1}return t.prototype.getId=function(){return this._id},t.prototype.isPlaying=function(){return this._isPlaying},t.prototype.isPaused=function(){return this._isPaused},t.prototype.to=function(t,e){return this._valuesEnd=Object.create(t),void 0!==e&&(this._duration=e),this},t.prototype.duration=function(t){return this._duration=t,this},t.prototype.start=function(t){if(this._isPlaying)return this;if(this._group&&this._group.add(this),this._repeat=this._initialRepeat,this._reversed)for(var e in this._reversed=!1,this._valuesStartRepeat)this._swapEndStartRepeatValues(e),this._valuesStart[e]=this._valuesStartRepeat[e];return this._isPlaying=!0,this._isPaused=!1,this._onStartCallbackFired=!1,this._isChainStopped=!1,this._startTime=void 0!==t?"string"==typeof t?r()+parseFloat(t):t:r(),this._startTime+=this._delayTime,this._setupProperties(this._object,this._valuesStart,this._valuesEnd,this._valuesStartRepeat),this},t.prototype._setupProperties=function(t,e,n,i){for(var o in n){var s=t[o],a=Array.isArray(s),r=a?"array":typeof s,l=!a&&Array.isArray(n[o]);if("undefined"!==r&&"function"!==r){if(l){var d=n[o];if(0===d.length)continue;d=d.map(this._handleRelativeValue.bind(this,s)),n[o]=[s].concat(d)}if("object"!==r&&!a||!s||l)void 0===e[o]&&(e[o]=s),a||(e[o]*=1),i[o]=l?n[o].slice().reverse():e[o]||0;else{for(var u in e[o]=a?[]:{},s)e[o][u]=s[u];i[o]=a?[]:{},this._setupProperties(s,e[o],n[o],i[o])}}}},t.prototype.stop=function(){return this._isChainStopped||(this._isChainStopped=!0,this.stopChainedTweens()),this._isPlaying?(this._group&&this._group.remove(this),this._isPlaying=!1,this._isPaused=!1,this._onStopCallback&&this._onStopCallback(this._object),this):this},t.prototype.end=function(){return this._goToEnd=!0,this.update(1/0),this},t.prototype.pause=function(t){return void 0===t&&(t=r()),this._isPaused||!this._isPlaying||(this._isPaused=!0,this._pauseStart=t,this._group&&this._group.remove(this)),this},t.prototype.resume=function(t){return void 0===t&&(t=r()),this._isPaused&&this._isPlaying?(this._isPaused=!1,this._startTime+=t-this._pauseStart,this._pauseStart=0,this._group&&this._group.add(this),this):this},t.prototype.stopChainedTweens=function(){for(var t=0,e=this._chainedTweens.length;t<e;t++)this._chainedTweens[t].stop();return this},t.prototype.group=function(t){return this._group=t,this},t.prototype.delay=function(t){return this._delayTime=t,this},t.prototype.repeat=function(t){return this._initialRepeat=t,this._repeat=t,this},t.prototype.repeatDelay=function(t){return this._repeatDelayTime=t,this},t.prototype.yoyo=function(t){return this._yoyo=t,this},t.prototype.easing=function(t){return this._easingFunction=t,this},t.prototype.interpolation=function(t){return this._interpolationFunction=t,this},t.prototype.chain=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this._chainedTweens=t,this},t.prototype.onStart=function(t){return this._onStartCallback=t,this},t.prototype.onUpdate=function(t){return this._onUpdateCallback=t,this},t.prototype.onRepeat=function(t){return this._onRepeatCallback=t,this},t.prototype.onComplete=function(t){return this._onCompleteCallback=t,this},t.prototype.onStop=function(t){return this._onStopCallback=t,this},t.prototype.update=function(t,e){if(void 0===t&&(t=r()),void 0===e&&(e=!0),this._isPaused)return!0;var n,i,o=this._startTime+this._duration;if(!this._goToEnd&&!this._isPlaying){if(t>o)return!1;e&&this.start(t)}if(this._goToEnd=!1,t<this._startTime)return!0;!1===this._onStartCallbackFired&&(this._onStartCallback&&this._onStartCallback(this._object),this._onStartCallbackFired=!0),i=(t-this._startTime)/this._duration,i=0===this._duration||i>1?1:i;var s=this._easingFunction(i);if(this._updateProperties(this._object,this._valuesStart,this._valuesEnd,s),this._onUpdateCallback&&this._onUpdateCallback(this._object,i),1===i){if(this._repeat>0){for(n in isFinite(this._repeat)&&this._repeat--,this._valuesStartRepeat)this._yoyo||"string"!=typeof this._valuesEnd[n]||(this._valuesStartRepeat[n]=this._valuesStartRepeat[n]+parseFloat(this._valuesEnd[n])),this._yoyo&&this._swapEndStartRepeatValues(n),this._valuesStart[n]=this._valuesStartRepeat[n];return this._yoyo&&(this._reversed=!this._reversed),void 0!==this._repeatDelayTime?this._startTime=t+this._repeatDelayTime:this._startTime=t+this._delayTime,this._onRepeatCallback&&this._onRepeatCallback(this._object),!0}this._onCompleteCallback&&this._onCompleteCallback(this._object);for(var a=0,l=this._chainedTweens.length;a<l;a++)this._chainedTweens[a].start(this._startTime+this._duration);return this._isPlaying=!1,!1}return!0},t.prototype._updateProperties=function(t,e,n,i){for(var o in n)if(void 0!==e[o]){var s=e[o]||0,a=n[o],r=Array.isArray(t[o]),l=Array.isArray(a);!r&&l?t[o]=this._interpolationFunction(a,i):"object"==typeof a&&a?this._updateProperties(t[o],s,a,i):"number"==typeof(a=this._handleRelativeValue(s,a))&&(t[o]=s+(a-s)*i)}},t.prototype._handleRelativeValue=function(t,e){return"string"!=typeof e?e:"+"===e.charAt(0)||"-"===e.charAt(0)?t+parseFloat(e):parseFloat(e)},t.prototype._swapEndStartRepeatValues=function(t){var e=this._valuesStartRepeat[t],n=this._valuesEnd[t];this._valuesStartRepeat[t]="string"==typeof n?this._valuesStartRepeat[t]+parseFloat(n):this._valuesEnd[t],this._valuesEnd[t]=e},t}(),p=u.nextId,f=h,m=f.getAll.bind(f),v=f.removeAll.bind(f),y=f.add.bind(f),g=f.remove.bind(f),x=f.update.bind(f),w={Easing:a,Group:l,Interpolation:d,now:r,Sequence:u,nextId:p,Tween:c,VERSION:"18.6.4",getAll:m,removeAll:v,add:y,remove:g,update:x}})),s.register("2w5cf",(function(e,n){var i;t(e.exports,"get",(()=>i),(t=>i=t)),i=(t,e)=>{const n=new Map,i=new EventTarget;function o(t,e){const n=new CustomEvent(t,{detail:e}),o={type:t};Object.assign(o,e);const s=new CustomEvent("gamepadInteraction",{detail:o});i.dispatchEvent(n),i.dispatchEvent(s)}return e.add(((e,i)=>{const s=t.xr.getSession();let a=0;if(s)for(const e of s.inputSources){if(!e.gamepad)continue;const i=t.xr.getController(a++),s=n.get(e),r={buttons:e.gamepad.buttons.map((t=>t.value)),axes:e.gamepad.axes.slice(0)};s&&(r.buttons.forEach(((t,n)=>{t!==s.buttons[n]&&o(1===t?`button${n}Down`:`button${n}Up`,{value:t,source:e,controller:i,data:r})})),r.axes.forEach(((t,n)=>{t!==s.axes[n]&&(o(`axes${n}Move`,{value:t,source:e,controller:i,data:r}),0===s.axes[n]&&o(`axes${n}MoveStart`,{value:t,source:e,controller:i,data:r}),Math.abs(s.axes[n])<.5&&Math.abs(t)>.5&&o(`axes${n}MoveMiddle`,{value:t,source:e,controller:i,data:r}),0===t&&o(`axes${n}MoveEnd`,{value:t,source:e,controller:i,data:r}))}))),n.set(e,r)}})),i}}));var a=s("3NNSQ"),r=s("33SoD"),l=s("ilwiq"),d=s("7lx9d");class u{static createButton(t){const e=document.createElement("button");function n(){e.style.display="",e.style.cursor="auto",e.style.left="calc(50% - 75px)",e.style.width="150px",e.onmouseenter=null,e.onmouseleave=null,e.onclick=null}function i(t){t.style.position="absolute",t.style.bottom="20px",t.style.padding="12px 6px",t.style.border="1px solid #fff",t.style.borderRadius="4px",t.style.background="rgba(0,0,0,0.1)",t.style.color="#fff",t.style.font="normal 13px sans-serif",t.style.textAlign="center",t.style.opacity="0.5",t.style.outline="none",t.style.zIndex="999"}if("xr"in navigator)return e.id="VRButton",e.style.display="none",i(e),navigator.xr.isSessionSupported("immersive-vr").then((function(i){i?function(){let n=null;async function i(i){i.addEventListener("end",o),await t.xr.setSession(i),e.textContent="EXIT VR",n=i}function o(){n.removeEventListener("end",o),e.textContent="ENTER VR",n=null}e.style.display="",e.style.cursor="pointer",e.style.left="calc(50% - 50px)",e.style.width="100px",e.textContent="ENTER VR",e.onmouseenter=function(){e.style.opacity="1.0"},e.onmouseleave=function(){e.style.opacity="0.5"},e.onclick=function(){if(null===n){const t={optionalFeatures:["local-floor","bounded-floor","hand-tracking","layers"]};navigator.xr.requestSession("immersive-vr",t).then(i)}else n.end()}}():(n(),e.textContent="VR NOT SUPPORTED"),i&&u.xrSessionIsGranted&&e.click()})).catch((function(t){n(),console.warn("Exception when trying to call xr.isSessionSupported",t),e.textContent="VR NOT ALLOWED"})),e;{const t=document.createElement("a");return!1===window.isSecureContext?(t.href=document.location.href.replace(/^http:/,"https:"),t.innerHTML="WEBXR NEEDS HTTPS"):(t.href="https://immersiveweb.dev/",t.innerHTML="WEBXR NOT AVAILABLE"),t.style.left="calc(50% - 90px)",t.style.width="180px",t.style.textDecoration="none",i(t),t}}static xrSessionIsGranted=!1;static registerSessionGrantedListener(){if("xr"in navigator){if(/WebXRViewer\//i.test(navigator.userAgent))return;navigator.xr.addEventListener("sessiongranted",(()=>{u.xrSessionIsGranted=!0}))}}}u.registerSessionGrantedListener(),s("8vghX").config();var h=s("hXJAl"),c=s("fZ8NE");l=s("ilwiq"),d=s("7lx9d");const p={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};async function f(t){const e=await fetch(t);if(e.ok)return e.json();throw new Error(e.statusText)}async function m(t,e,n=null,i=!0){if(!t)throw new Error("No xrInputSource supplied");if(!e)throw new Error("No basePath supplied");const o=await async function(t){if(!t)throw new Error("No basePath supplied");return await f(`${t}/profilesList.json`)}(e);let s;if(t.profiles.some((t=>{const n=o[t];return n&&(s={profileId:t,profilePath:`${e}/${n.path}`,deprecated:!!n.deprecated}),!!s})),!s){if(!n)throw new Error("No matching profile name found");const t=o[n];if(!t)throw new Error(`No matching profile name found and default profile "${n}" missing.`);s={profileId:n,profilePath:`${e}/${t.path}`,deprecated:!!t.deprecated}}const a=await f(s.profilePath);let r;if(i){let e;if(e="any"===t.handedness?a.layouts[Object.keys(a.layouts)[0]]:a.layouts[t.handedness],!e)throw new Error(`No matching handedness, ${t.handedness}, in profile ${s.profileId}`);e.assetPath&&(r=s.profilePath.replace("profile.json",e.assetPath))}return{profile:a,assetPath:r}}const v={xAxis:0,yAxis:0,button:0,state:p.ComponentState.DEFAULT};class y{constructor(t){this.componentProperty=t.componentProperty,this.states=t.states,this.valueNodeName=t.valueNodeName,this.valueNodeProperty=t.valueNodeProperty,this.valueNodeProperty===p.VisualResponseProperty.TRANSFORM&&(this.minNodeName=t.minNodeName,this.maxNodeName=t.maxNodeName),this.value=0,this.updateFromComponent(v)}updateFromComponent({xAxis:t,yAxis:e,button:n,state:i}){const{normalizedXAxis:o,normalizedYAxis:s}=function(t=0,e=0){let n=t,i=e;if(Math.sqrt(t*t+e*e)>1){const o=Math.atan2(e,t);n=Math.cos(o),i=Math.sin(o)}return{normalizedXAxis:.5*n+.5,normalizedYAxis:.5*i+.5}}(t,e);switch(this.componentProperty){case p.ComponentProperty.X_AXIS:this.value=this.states.includes(i)?o:.5;break;case p.ComponentProperty.Y_AXIS:this.value=this.states.includes(i)?s:.5;break;case p.ComponentProperty.BUTTON:this.value=this.states.includes(i)?n:0;break;case p.ComponentProperty.STATE:this.valueNodeProperty===p.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(i):this.value=this.states.includes(i)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}}class g{constructor(t,e){if(!(t&&e&&e.visualResponses&&e.gamepadIndices&&0!==Object.keys(e.gamepadIndices).length))throw new Error("Invalid arguments supplied");this.id=t,this.type=e.type,this.rootNodeName=e.rootNodeName,this.touchPointNodeName=e.touchPointNodeName,this.visualResponses={},Object.keys(e.visualResponses).forEach((t=>{const n=new y(e.visualResponses[t]);this.visualResponses[t]=n})),this.gamepadIndices=Object.assign({},e.gamepadIndices),this.values={state:p.ComponentState.DEFAULT,button:void 0!==this.gamepadIndices.button?0:void 0,xAxis:void 0!==this.gamepadIndices.xAxis?0:void 0,yAxis:void 0!==this.gamepadIndices.yAxis?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(t){if(this.values.state=p.ComponentState.DEFAULT,void 0!==this.gamepadIndices.button&&t.buttons.length>this.gamepadIndices.button){const e=t.buttons[this.gamepadIndices.button];this.values.button=e.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,e.pressed||1===this.values.button?this.values.state=p.ComponentState.PRESSED:(e.touched||this.values.button>p.ButtonTouchThreshold)&&(this.values.state=p.ComponentState.TOUCHED)}void 0!==this.gamepadIndices.xAxis&&t.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=t.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===p.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>p.AxisTouchThreshold&&(this.values.state=p.ComponentState.TOUCHED)),void 0!==this.gamepadIndices.yAxis&&t.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=t.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===p.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>p.AxisTouchThreshold&&(this.values.state=p.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach((t=>{t.updateFromComponent(this.values)}))}}class x{constructor(t,e,n){if(!t)throw new Error("No xrInputSource supplied");if(!e)throw new Error("No profile supplied");this.xrInputSource=t,this.assetUrl=n,this.id=e.profileId,this.layoutDescription=e.layouts[t.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach((t=>{const e=this.layoutDescription.components[t];this.components[t]=new g(t,e)})),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){const t=[];return Object.values(this.components).forEach((e=>{t.push(e.data)})),t}updateFromGamepad(){Object.values(this.components).forEach((t=>{t.updateFromGamepad(this.xrInputSource.gamepad)}))}}class w extends l.Object3D{constructor(){super(),this.motionController=null,this.envMap=null}setEnvironmentMap(t){return this.envMap==t||(this.envMap=t,this.traverse((t=>{t.isMesh&&(t.material.envMap=this.envMap,t.material.needsUpdate=!0)}))),this}updateMatrixWorld(t){super.updateMatrixWorld(t),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach((t=>{Object.values(t.visualResponses).forEach((t=>{const{valueNode:e,minNode:n,maxNode:i,value:o,valueNodeProperty:s}=t;e&&(s===p.VisualResponseProperty.VISIBILITY?e.visible=o:s===p.VisualResponseProperty.TRANSFORM&&(e.quaternion.slerpQuaternions(n.quaternion,i.quaternion,o),e.position.lerpVectors(n.position,i.position,o)))}))})))}}function _(t,e){!function(t,e){Object.values(t.components).forEach((t=>{const{type:n,touchPointNodeName:i,visualResponses:o}=t;if(n===p.ComponentType.TOUCHPAD)if(t.touchPointNode=e.getObjectByName(i),t.touchPointNode){const e=new(0,l.SphereGeometry)(.001),n=new(0,l.MeshBasicMaterial)({color:255}),i=new(0,l.Mesh)(e,n);t.touchPointNode.add(i)}else console.warn(`Could not find touch dot, ${t.touchPointNodeName}, in touchpad component ${t.id}`);Object.values(o).forEach((t=>{const{valueNodeName:n,minNodeName:i,maxNodeName:o,valueNodeProperty:s}=t;if(s===p.VisualResponseProperty.TRANSFORM){if(t.minNode=e.getObjectByName(i),t.maxNode=e.getObjectByName(o),!t.minNode)return void console.warn(`Could not find ${i} in the model`);if(!t.maxNode)return void console.warn(`Could not find ${o} in the model`)}t.valueNode=e.getObjectByName(n),t.valueNode||console.warn(`Could not find ${n} in the model`)}))}))}(t.motionController,e),t.envMap&&e.traverse((e=>{e.isMesh&&(e.material.envMap=t.envMap,e.material.needsUpdate=!0)})),t.add(e)}l=s("ilwiq");const b=new(0,(l=s("ilwiq")).Matrix4),M=new(0,l.Vector3);class S{constructor(t,e,n,i,o){let s;this.controller=e,this.handModel=t,this.envMap=null,o&&o.primitive&&"sphere"!==o.primitive?"box"===o.primitive&&(s=new(0,l.BoxGeometry)(1,1,1)):s=new(0,l.SphereGeometry)(1,10,10);const a=new(0,l.MeshStandardMaterial);this.handMesh=new(0,l.InstancedMesh)(s,a,30),this.handMesh.instanceMatrix.setUsage(l.DynamicDrawUsage),this.handMesh.castShadow=!0,this.handMesh.receiveShadow=!0,this.handModel.add(this.handMesh),this.joints=["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"]}updateMesh(){const t=this.controller.joints;let e=0;for(let n=0;n<this.joints.length;n++){const i=t[this.joints[n]];i.visible&&(M.setScalar(i.jointRadius||.008),b.compose(i.position,i.quaternion,M),this.handMesh.setMatrixAt(n,b),e++)}this.handMesh.count=e,this.handMesh.instanceMatrix.needsUpdate=!0}}d=s("7lx9d");class E{constructor(t,e,n,i){this.controller=e,this.handModel=t,this.bones=[];const o=new(0,d.GLTFLoader);o.setPath(n||"https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles/generic-hand/"),o.load(`${i}.glb`,(t=>{const e=t.scene.children[0];this.handModel.add(e);const n=e.getObjectByProperty("type","SkinnedMesh");n.frustumCulled=!1,n.castShadow=!0,n.receiveShadow=!0;["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"].forEach((t=>{const n=e.getObjectByName(t);void 0!==n?n.jointName=t:console.warn(`Couldn't find ${t} in ${i} hand mesh`),this.bones.push(n)}))}))}updateMesh(){const t=this.controller.joints;for(let e=0;e<this.bones.length;e++){const n=this.bones[e];if(n){const e=t[n.jointName];if(e.visible){const t=e.position;n.position.copy(t),n.quaternion.copy(e.quaternion)}}}}}class C extends l.Object3D{constructor(t){super(),this.controller=t,this.motionController=null,this.envMap=null,this.mesh=null}updateMatrixWorld(t){super.updateMatrixWorld(t),this.motionController&&this.motionController.updateMesh()}}var P;const I=new class{constructor(t=null){this.gltfLoader=t,this.path="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",this._assetCache={},this.gltfLoader||(this.gltfLoader=new(0,d.GLTFLoader))}createControllerModel(t){const e=new w;let n=null;return t.addEventListener("connected",(t=>{const i=t.data;"tracked-pointer"===i.targetRayMode&&i.gamepad&&m(i,this.path,"generic-trigger").then((({profile:t,assetPath:o})=>{e.motionController=new x(i,t,o);const s=this._assetCache[e.motionController.assetUrl];if(s)n=s.scene.clone(),_(e,n);else{if(!this.gltfLoader)throw new Error("GLTFLoader not set.");this.gltfLoader.setPath(""),this.gltfLoader.load(e.motionController.assetUrl,(t=>{this._assetCache[e.motionController.assetUrl]=t,n=t.scene.clone(),_(e,n)}),null,(()=>{throw new Error(`Asset ${e.motionController.assetUrl} missing or malformed.`)}))}})).catch((t=>{console.warn(t)}))})),t.addEventListener("disconnected",(()=>{e.motionController=null,e.remove(n),n=null})),e}},T=new class{constructor(){this.path=null}setPath(t){return this.path=t,this}createHandModel(t,e){const n=new C(t);return t.addEventListener("connected",(i=>{const o=i.data;o.hand&&!n.motionController&&(n.xrInputSource=o,void 0===e||"spheres"===e?n.motionController=new S(n,t,this.path,o.handedness,{primitive:"sphere"}):"boxes"===e?n.motionController=new S(n,t,this.path,o.handedness,{primitive:"box"}):"mesh"===e&&(n.motionController=new E(n,t,this.path,o.handedness))),t.visible=!0})),t.addEventListener("disconnected",(()=>{t.visible=!1})),n}};P=(t,e)=>{const n=[0,1].map((function(n){const i=t.xr.getController(n);e.add(i);const o=t.xr.getControllerGrip(n),s=I.createControllerModel(o);o.add(s),e.add(o);const a=t.xr.getHand(n);return a.add(T.createHandModel(a,"mesh")),e.add(a),{hand:a,grip:o,controller:i}})),i=n[0].controller,o=n[1].controller,s=n[0].hand,a=n[1].hand;return{controller1:i,controller2:o,controllerGrip1:n[0].grip,controllerGrip2:n[1].grip,hand1:s,hand2:a}};var A;l=s("ilwiq");A=(t,e,n,i,o,a,r)=>{const d=s("2xTO9")(n,i),u=new(0,l.Vector3)(0,-9.8,0),h=new(0,l.Vector3),c=new(0,l.Vector3),p=new(0,l.Vector3),f=new(0,l.Vector3);function m(t,e,n,i,o){return t.copy(n),t.addScaledVector(i,e),t.addScaledVector(o,.5*e**2),t}const v=new(0,l.BufferGeometry),y=new Float32Array(33);y.fill(0);const g=new Float32Array(33);g.fill(.5),v.setAttribute("position",new(0,l.BufferAttribute)(y,3)),v.setAttribute("color",new(0,l.BufferAttribute)(g,3));const x=new(0,l.LineBasicMaterial)({vertexColors:!0,blending:l.AdditiveBlending}),w=new(0,l.Line)(v,x),_=new(0,l.PointLight)(16772778,0,2),b=(new(0,l.TextureLoader)).load("/assets/img/target.png"),M=new(0,l.Mesh)(new(0,l.PlaneGeometry)(.3,.3,1,1),new(0,l.MeshBasicMaterial)({map:b,blending:l.AdditiveBlending,color:5592405,transparent:!0}));M.rotation.x=-Math.PI/2;let S=null;function E(e){if(e&&e.data&&e.data.hand)return;const n=this;console.log("startGuide",n),S=n,_.intensity=1,n.add(w),t.add(M)}function C(){if(S===this){console.log("onSelectEnd",this);const i=e.xr.getCamera(n).getWorldPosition(h);i.y=0;const o=S.getWorldPosition(p),s=S.getWorldDirection(f);s.multiplyScalar(6);const a=(-s.y+Math.sqrt(s.y**2-2*o.y*u.y))/u.y,r=m(c,a,o,s,u).addScaledVector(i,-1);d(r),S=null,_.intensity=0,this.remove(w),t.remove(M)}}function P({detail:t}){t.value>0&&(i.rotation.y-=Math.PI/4),t.value<0&&(i.rotation.y+=Math.PI/4)}function I({detail:t}){t.value<0&&E.bind(t.controller)()}function T({detail:t}){C.bind(t.controller)()}const A=s("2w5cf").get(e,o);A.addEventListener("axes0MoveMiddle",P,!0),A.addEventListener("axes2MoveMiddle",P,!0),A.addEventListener("axes1MoveMiddle",I,!0),A.addEventListener("axes3MoveMiddle",I,!0),A.addEventListener("axes1MoveEnd",T,!0),A.addEventListener("axes3MoveEnd",T,!0),a.addEventListener("selectstart",E),a.addEventListener("selectend",C),r.addEventListener("selectstart",E),r.addEventListener("selectend",C),o.add((()=>{if(S){const t=S.getWorldPosition(p),e=S.getWorldDirection(f);e.multiplyScalar(6);const n=(-e.y+Math.sqrt(e.y**2-2*t.y*u.y))/u.y,i=h.set(0,0,0);for(let o=1;o<=10;o++)m(i,o*n/10,t,e,u),S.worldToLocal(i),i.toArray(y,3*o);w.geometry.attributes.position.needsUpdate=!0,m(_.position,.98*n,t,e,u),m(M.position,.98*n,t,e,u)}}))};var N=s("6Awmu"),O=N.displayPainting;N.clearPaintings;let R,L,j;const k=new RegExp("^0x[a-fA-F0-9]{40}$"),F=new Proxy(new URLSearchParams(window.location.search),{get:(t,e)=>t.get(e)}),U=new(0,d.GLTFLoader),D=new l.Scene;let B=new l.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3);const G=new l.Group;G.add(B);const V=new l.WebGLRenderer({antialias:!0});function $(){B.aspect=window.innerWidth/window.innerHeight,B.updateProjectionMatrix(),V.setSize(window.innerWidth,window.innerHeight)}V.shadowMap.enabled=!0,D.background=new l.Color(135,206,235),V.setSize(window.innerWidth,window.innerHeight),V.xr.enabled=!0,window.init3d=t=>new Promise(((e,n)=>{const i=c.findById(t);console.log("Gallery Preset",i),U.load(i.location,(async function(t){R=t.scene,R.scale.set(i.scene.scale,i.scene.scale,i.scene.scale),R.position.set(i.scene.position.x,i.scene.position.y,i.scene.position.z),B.fov=i.camera.fov,B.updateProjectionMatrix(),B.position.set(i.camera.position.x,i.camera.position.y,i.camera.position.z),"function"==typeof i.postRenderModifier&&await i.postRenderModifier(R),D.add(R),D.add(G);const n=new Set;V.xr.addEventListener("sessionstart",(function(){const{controller1:t,controller2:e,controllerGrip1:i,controllerGrip2:o,hand1:s,hand2:a}=P(V,G);A(D,V,B,G,n,t,e)})),window.addEventListener("resize",$,!1),$(),V.setAnimationLoop((function(t,e){n.forEach((n=>n(t,e))),V.render(D,B)})),e()}),(()=>{}),(t=>{console.log(t),n()})),document.body.appendChild(V.domElement),document.body.appendChild(u.createButton(V))})),window.loadGallery=async()=>{if(!k.test(F.g)&&"example"!==F.g)return alert("Invalid Gallery Address!");L=new(e(a))("https://testnet-rpc.coinex.net"),j=new L.eth.Contract(e(r),"example"===F.g?"0x1cF90b43Cb52478C4a066F57a1DFB1849C191048":F.g),h.show();const t=parseInt(await j.methods.getGalleryIndex().call()),n=await j.methods.getPaintings().call();console.log("Paintings",n),await init3d(t);for(const t in n)O(R,n[t].posX,n[t].posY,n[t].posZ,n[t].rotX,n[t].rotY,n[t].rotZ,n[t].width,n[t].aspect,n[t].url);h.hide()},loadGallery();
//# sourceMappingURL=gallery.8536e40f.js.map
