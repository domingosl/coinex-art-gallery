function e(e){return e&&e.__esModule?e.default:e}var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},o={},n={},s=t.parcelRequire4141;null==s&&((s=function(e){if(e in o)return o[e].exports;if(e in n){var t=n[e];delete n[e];var s={id:e,exports:{}};return o[e]=s,t.call(s.exports,s,s.exports),s.exports}var i=new Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}).register=function(e,t){n[e]=t},t.parcelRequire4141=s);var i=s("3NNSQ"),a=s("33SoD"),r=s("ilwiq"),l=s("7lx9d");class d{static createButton(e){const t=document.createElement("button");function o(){t.style.display="",t.style.cursor="auto",t.style.left="calc(50% - 75px)",t.style.width="150px",t.onmouseenter=null,t.onmouseleave=null,t.onclick=null}function n(e){e.style.position="absolute",e.style.bottom="20px",e.style.padding="12px 6px",e.style.border="1px solid #fff",e.style.borderRadius="4px",e.style.background="rgba(0,0,0,0.1)",e.style.color="#fff",e.style.font="normal 13px sans-serif",e.style.textAlign="center",e.style.opacity="0.5",e.style.outline="none",e.style.zIndex="999"}if("xr"in navigator)return t.id="VRButton",t.style.display="none",n(t),navigator.xr.isSessionSupported("immersive-vr").then((function(n){n?function(){let o=null;async function n(n){n.addEventListener("end",s),await e.xr.setSession(n),t.textContent="EXIT VR",o=n}function s(){o.removeEventListener("end",s),t.textContent="ENTER VR",o=null}t.style.display="",t.style.cursor="pointer",t.style.left="calc(50% - 50px)",t.style.width="100px",t.textContent="ENTER VR",t.onmouseenter=function(){t.style.opacity="1.0"},t.onmouseleave=function(){t.style.opacity="0.5"},t.onclick=function(){if(null===o){const e={optionalFeatures:["local-floor","bounded-floor","hand-tracking","layers"]};navigator.xr.requestSession("immersive-vr",e).then(n)}else o.end()}}():(o(),t.textContent="VR NOT SUPPORTED"),n&&d.xrSessionIsGranted&&t.click()})).catch((function(e){o(),console.warn("Exception when trying to call xr.isSessionSupported",e),t.textContent="VR NOT ALLOWED"})),t;{const e=document.createElement("a");return!1===window.isSecureContext?(e.href=document.location.href.replace(/^http:/,"https:"),e.innerHTML="WEBXR NEEDS HTTPS"):(e.href="https://immersiveweb.dev/",e.innerHTML="WEBXR NOT AVAILABLE"),e.style.left="calc(50% - 90px)",e.style.width="180px",e.style.textDecoration="none",n(e),e}}static xrSessionIsGranted=!1;static registerSessionGrantedListener(){if("xr"in navigator){if(/WebXRViewer\//i.test(navigator.userAgent))return;navigator.xr.addEventListener("sessiongranted",(()=>{d.xrSessionIsGranted=!0}))}}}d.registerSessionGrantedListener();r=s("ilwiq"),l=s("7lx9d");const c={Handedness:Object.freeze({NONE:"none",LEFT:"left",RIGHT:"right"}),ComponentState:Object.freeze({DEFAULT:"default",TOUCHED:"touched",PRESSED:"pressed"}),ComponentProperty:Object.freeze({BUTTON:"button",X_AXIS:"xAxis",Y_AXIS:"yAxis",STATE:"state"}),ComponentType:Object.freeze({TRIGGER:"trigger",SQUEEZE:"squeeze",TOUCHPAD:"touchpad",THUMBSTICK:"thumbstick",BUTTON:"button"}),ButtonTouchThreshold:.05,AxisTouchThreshold:.1,VisualResponseProperty:Object.freeze({TRANSFORM:"transform",VISIBILITY:"visibility"})};async function u(e){const t=await fetch(e);if(t.ok)return t.json();throw new Error(t.statusText)}async function p(e,t,o=null,n=!0){if(!e)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No basePath supplied");const s=await async function(e){if(!e)throw new Error("No basePath supplied");return await u(`${e}/profilesList.json`)}(t);let i;if(e.profiles.some((e=>{const o=s[e];return o&&(i={profileId:e,profilePath:`${t}/${o.path}`,deprecated:!!o.deprecated}),!!i})),!i){if(!o)throw new Error("No matching profile name found");const e=s[o];if(!e)throw new Error(`No matching profile name found and default profile "${o}" missing.`);i={profileId:o,profilePath:`${t}/${e.path}`,deprecated:!!e.deprecated}}const a=await u(i.profilePath);let r;if(n){let t;if(t="any"===e.handedness?a.layouts[Object.keys(a.layouts)[0]]:a.layouts[e.handedness],!t)throw new Error(`No matching handedness, ${e.handedness}, in profile ${i.profileId}`);t.assetPath&&(r=i.profilePath.replace("profile.json",t.assetPath))}return{profile:a,assetPath:r}}const h={xAxis:0,yAxis:0,button:0,state:c.ComponentState.DEFAULT};class m{constructor(e){this.componentProperty=e.componentProperty,this.states=e.states,this.valueNodeName=e.valueNodeName,this.valueNodeProperty=e.valueNodeProperty,this.valueNodeProperty===c.VisualResponseProperty.TRANSFORM&&(this.minNodeName=e.minNodeName,this.maxNodeName=e.maxNodeName),this.value=0,this.updateFromComponent(h)}updateFromComponent({xAxis:e,yAxis:t,button:o,state:n}){const{normalizedXAxis:s,normalizedYAxis:i}=function(e=0,t=0){let o=e,n=t;if(Math.sqrt(e*e+t*t)>1){const s=Math.atan2(t,e);o=Math.cos(s),n=Math.sin(s)}return{normalizedXAxis:.5*o+.5,normalizedYAxis:.5*n+.5}}(e,t);switch(this.componentProperty){case c.ComponentProperty.X_AXIS:this.value=this.states.includes(n)?s:.5;break;case c.ComponentProperty.Y_AXIS:this.value=this.states.includes(n)?i:.5;break;case c.ComponentProperty.BUTTON:this.value=this.states.includes(n)?o:0;break;case c.ComponentProperty.STATE:this.valueNodeProperty===c.VisualResponseProperty.VISIBILITY?this.value=this.states.includes(n):this.value=this.states.includes(n)?1:0;break;default:throw new Error(`Unexpected visualResponse componentProperty ${this.componentProperty}`)}}}class f{constructor(e,t){if(!(e&&t&&t.visualResponses&&t.gamepadIndices&&0!==Object.keys(t.gamepadIndices).length))throw new Error("Invalid arguments supplied");this.id=e,this.type=t.type,this.rootNodeName=t.rootNodeName,this.touchPointNodeName=t.touchPointNodeName,this.visualResponses={},Object.keys(t.visualResponses).forEach((e=>{const o=new m(t.visualResponses[e]);this.visualResponses[e]=o})),this.gamepadIndices=Object.assign({},t.gamepadIndices),this.values={state:c.ComponentState.DEFAULT,button:void 0!==this.gamepadIndices.button?0:void 0,xAxis:void 0!==this.gamepadIndices.xAxis?0:void 0,yAxis:void 0!==this.gamepadIndices.yAxis?0:void 0}}get data(){return{id:this.id,...this.values}}updateFromGamepad(e){if(this.values.state=c.ComponentState.DEFAULT,void 0!==this.gamepadIndices.button&&e.buttons.length>this.gamepadIndices.button){const t=e.buttons[this.gamepadIndices.button];this.values.button=t.value,this.values.button=this.values.button<0?0:this.values.button,this.values.button=this.values.button>1?1:this.values.button,t.pressed||1===this.values.button?this.values.state=c.ComponentState.PRESSED:(t.touched||this.values.button>c.ButtonTouchThreshold)&&(this.values.state=c.ComponentState.TOUCHED)}void 0!==this.gamepadIndices.xAxis&&e.axes.length>this.gamepadIndices.xAxis&&(this.values.xAxis=e.axes[this.gamepadIndices.xAxis],this.values.xAxis=this.values.xAxis<-1?-1:this.values.xAxis,this.values.xAxis=this.values.xAxis>1?1:this.values.xAxis,this.values.state===c.ComponentState.DEFAULT&&Math.abs(this.values.xAxis)>c.AxisTouchThreshold&&(this.values.state=c.ComponentState.TOUCHED)),void 0!==this.gamepadIndices.yAxis&&e.axes.length>this.gamepadIndices.yAxis&&(this.values.yAxis=e.axes[this.gamepadIndices.yAxis],this.values.yAxis=this.values.yAxis<-1?-1:this.values.yAxis,this.values.yAxis=this.values.yAxis>1?1:this.values.yAxis,this.values.state===c.ComponentState.DEFAULT&&Math.abs(this.values.yAxis)>c.AxisTouchThreshold&&(this.values.state=c.ComponentState.TOUCHED)),Object.values(this.visualResponses).forEach((e=>{e.updateFromComponent(this.values)}))}}class v{constructor(e,t,o){if(!e)throw new Error("No xrInputSource supplied");if(!t)throw new Error("No profile supplied");this.xrInputSource=e,this.assetUrl=o,this.id=t.profileId,this.layoutDescription=t.layouts[e.handedness],this.components={},Object.keys(this.layoutDescription.components).forEach((e=>{const t=this.layoutDescription.components[e];this.components[e]=new f(e,t)})),this.updateFromGamepad()}get gripSpace(){return this.xrInputSource.gripSpace}get targetRaySpace(){return this.xrInputSource.targetRaySpace}get data(){const e=[];return Object.values(this.components).forEach((t=>{e.push(t.data)})),e}updateFromGamepad(){Object.values(this.components).forEach((e=>{e.updateFromGamepad(this.xrInputSource.gamepad)}))}}class x extends r.Object3D{constructor(){super(),this.motionController=null,this.envMap=null}setEnvironmentMap(e){return this.envMap==e||(this.envMap=e,this.traverse((e=>{e.isMesh&&(e.material.envMap=this.envMap,e.material.needsUpdate=!0)}))),this}updateMatrixWorld(e){super.updateMatrixWorld(e),this.motionController&&(this.motionController.updateFromGamepad(),Object.values(this.motionController.components).forEach((e=>{Object.values(e.visualResponses).forEach((e=>{const{valueNode:t,minNode:o,maxNode:n,value:s,valueNodeProperty:i}=e;t&&(i===c.VisualResponseProperty.VISIBILITY?t.visible=s:i===c.VisualResponseProperty.TRANSFORM&&(t.quaternion.slerpQuaternions(o.quaternion,n.quaternion,s),t.position.lerpVectors(o.position,n.position,s)))}))})))}}function y(e,t){!function(e,t){Object.values(e.components).forEach((e=>{const{type:o,touchPointNodeName:n,visualResponses:s}=e;if(o===c.ComponentType.TOUCHPAD)if(e.touchPointNode=t.getObjectByName(n),e.touchPointNode){const t=new(0,r.SphereGeometry)(.001),o=new(0,r.MeshBasicMaterial)({color:255}),n=new(0,r.Mesh)(t,o);e.touchPointNode.add(n)}else console.warn(`Could not find touch dot, ${e.touchPointNodeName}, in touchpad component ${e.id}`);Object.values(s).forEach((e=>{const{valueNodeName:o,minNodeName:n,maxNodeName:s,valueNodeProperty:i}=e;if(i===c.VisualResponseProperty.TRANSFORM){if(e.minNode=t.getObjectByName(n),e.maxNode=t.getObjectByName(s),!e.minNode)return void console.warn(`Could not find ${n} in the model`);if(!e.maxNode)return void console.warn(`Could not find ${s} in the model`)}e.valueNode=t.getObjectByName(o),e.valueNode||console.warn(`Could not find ${o} in the model`)}))}))}(e.motionController,t),e.envMap&&t.traverse((t=>{t.isMesh&&(t.material.envMap=e.envMap,t.material.needsUpdate=!0)})),e.add(t)}class w{constructor(e=null){this.gltfLoader=e,this.path="https://cdn.jsdelivr.net/npm/@webxr-input-profiles/assets@1.0/dist/profiles",this._assetCache={},this.gltfLoader||(this.gltfLoader=new(0,l.GLTFLoader))}createControllerModel(e){const t=new x;let o=null;return e.addEventListener("connected",(e=>{const n=e.data;"tracked-pointer"===n.targetRayMode&&n.gamepad&&p(n,this.path,"generic-trigger").then((({profile:e,assetPath:s})=>{t.motionController=new v(n,e,s);const i=this._assetCache[t.motionController.assetUrl];if(i)o=i.scene.clone(),y(t,o);else{if(!this.gltfLoader)throw new Error("GLTFLoader not set.");this.gltfLoader.setPath(""),this.gltfLoader.load(t.motionController.assetUrl,(e=>{this._assetCache[t.motionController.assetUrl]=e,o=e.scene.clone(),y(t,o)}),null,(()=>{throw new Error(`Asset ${t.motionController.assetUrl} missing or malformed.`)}))}})).catch((e=>{console.warn(e)}))})),e.addEventListener("disconnected",(()=>{t.motionController=null,t.remove(o),o=null})),t}}s("8vghX").config();var g=s("hXJAl"),b=s("fZ8NE"),N=s("6Awmu"),A=N.displayPainting;N.clearPaintings;let E,T,C;const S=new RegExp("^0x[a-fA-F0-9]{40}$"),P=new Proxy(new URLSearchParams(window.location.search),{get:(e,t)=>e.get(t)}),I=new(0,l.GLTFLoader),R=new r.Scene;let O=new r.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.1,1e3);const L=new r.WebGLRenderer({antialias:!0});function M(){O.aspect=window.innerWidth/window.innerHeight,O.updateProjectionMatrix(),L.setSize(window.innerWidth,window.innerHeight)}L.shadowMap.enabled=!0,R.background=new r.Color(135,206,235),L.setSize(window.innerWidth,window.innerHeight),L.xr.enabled=!0,window.init3d=e=>new Promise(((t,o)=>{const n=b.findById(e);console.log("Gallery Preset",n),I.load(n.location,(async function(e){E=e.scene,E.scale.set(n.scene.scale,n.scene.scale,n.scene.scale),E.position.set(n.scene.position.x,n.scene.position.y,n.scene.position.z),O.fov=n.camera.fov,O.position.set(n.camera.position.x,n.camera.position.y,n.camera.position.z),"function"==typeof n.postRenderModifier&&await n.postRenderModifier(E),R.add(E),window.addEventListener("resize",M,!1),M(),L.setAnimationLoop((function(){L.render(R,O)})),t()}),(()=>{}),(e=>{console.log(e),o()}));let s=L.xr.getController(0);const i=e=>{let t,o;switch(e.targetRayMode){case"tracked-pointer":return t=new r.BufferGeometry,t.setAttribute("position",new r.Float32BufferAttribute([0,0,0,0,0,-1],3)),t.setAttribute("color",new r.Float32BufferAttribute([.5,.5,.5,0,0,0],3)),o=new r.LineBasicMaterial({vertexColors:!0,blending:r.AdditiveBlending}),new r.Line(t,o);case"gaze":return t=new r.RingBufferGeometry(.02,.04,32).translate(0,0,-1),o=new r.MeshBasicMaterial({opacity:.5,transparent:!0}),new r.Mesh(t,o)}};s.addEventListener("connected",(function(e){const t=i.call(self,e.data);t.scale.z=0,R.add(t)})),s.addEventListener("disconnected",(function(){R.remove(this.children[0]),s=null,l=null})),R.add(s);const a=new w;let l=L.xr.getControllerGrip(0);l.add(a.createControllerModel(l)),R.add(l);const c=new r.Object3D;c.position.z=5,c.add(O),R.add(c);const u=new r.Object3D;O.add(u),document.body.appendChild(L.domElement),document.body.appendChild(d.createButton(L))})),window.loadGallery=async()=>{if(!S.test(P.g))return alert("Invalid Gallery Address!");T=new(e(i))("https://testnet-rpc.coinex.net"),C=new T.eth.Contract(e(a),P.g),g.show();const t=parseInt(await C.methods.getGalleryIndex().call());console.log(t);const o=await C.methods.getPaintings().call();console.log("Paintings",o),await init3d(t);for(const e in o)A(E,o[e].posX,o[e].posY,o[e].posZ,o[e].rotX,o[e].rotY,o[e].rotZ,o[e].width,o[e].aspect,o[e].url);g.hide()},loadGallery();
//# sourceMappingURL=gallery.6aaabe6f.js.map
